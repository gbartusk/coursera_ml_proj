---
title: "Weight Lifting Exercises"
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```


```{r load_pkgs}
# - load packages
library(knitr)          # - report writing
library(ggplot2)        # - plotting
library(gridExtra)      # - panel plots
library(dplyr)          # - data manipulation
library(readr)          # - fast csv reads
library(RCurl)          # - network interface
library(lubridate)      # - date functions
library(Metrics)        # - supervised learning evaluation metrics
library(ggmap)          # - maps
library(Hmisc)          # - 
library(MASS)           # - applied stats methods
library(class)          # - functions for classification
library(caret)          # - model training functions
library(pryr)           # - check memory
library(rpart)          # - regression trees
library(rattle)         # - regression tree plots
library(gbm)            # - boosting with trees

```


```{r load_udfs}
# - load data
load_data <- function(path)
{
    # - required libraries
    require(RCurl)          # - network interface
    require(dplyr)          # - data manipulation
    require(lubridate)      # - date functions
    
    # - download the url
    url_path <- RCurl::getURL(path)
    
    # - load data
    df_data <- read.csv(textConnection(url_path), stringsAsFactors=FALSE,
        na.strings = c("NA","","#DIV/0!"))
    
    # - update
    df_data <- df_data %>%
        dplyr::rename(row_num = X) %>%
        dplyr::mutate(
            cvtd_timestamp = lubridate::fast_strptime(cvtd_timestamp, "%m/%d/%Y %H:%M"),
            new_window = as.factor(new_window),
            user_name = as.factor(user_name)
        ) %>%
        dplyr::select(-row_num)
    
    if ( grepl("training", url_train) )
    {
        df_data$classe = as.factor(df_data$classe)
    }
    
    
    # - many columns that are 90%+ na values, lets drop those
    # - find variables with more than 90% na
    #df_na <- data.frame("na_pct" = sapply(df_data, function(x) sum(is.na(x))/length(x)))
    #df_na$var <- rownames(df_na)
    #df_na <- df_na %>% dplyr::select(var,na_pct) %>% dplyr::arrange(desc(na_pct))
    
    # - remove high pct na columns
    df_data <- df_data[, colSums(is.na(df_data))/nrow(df_data) < .9]
    
    # - return
    invisible(df_data)
}
    
```


```{r load_data}
# - file paths
url_train <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
url_test <- "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"

# - load data sets
df_train <- load_data(url_train)
df_test <- load_data(url_test)

# - check data
dim(df_train)
dim(df_test)
colnames(df_train)[!(colnames(df_train) %in% colnames(df_test))]

```


```{r data_vis}

table(df_train$classe)
table(df_train$user_name)
table(df_train$cvtd_timestamp)

df_train_num <- df_train %>% dplyr::select(-user_name, -raw_timestamp_part_1, -raw_timestamp_part_2, -cvtd_timestamp)

pairs(df_train_num)

```

